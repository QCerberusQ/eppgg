name: Digi php EPG GÃ¼ncelleme

on:
  schedule:
    # Her 30 dakikada bir Ã§alÄ±ÅŸÄ±r.
    # Ã–rnek: 00:00, 00:30, 01:00, 01:30 vb.
    - cron: '*/30 * * * *'
  # Ä°ÅŸ akÄ±ÅŸÄ±nÄ± manuel olarak tetiklemek iÃ§in
  workflow_dispatch:

permissions:
  contents: write # Depoya yazma izni verir

jobs:
  epg-update:
    runs-on: ubuntu-latest # Ä°ÅŸ akÄ±ÅŸÄ± iÃ§in Ubuntu iÅŸletim sistemi kullanÄ±r

    steps:
      - name: Depoyu Klonla
        # Mevcut depoyu runner'a klonlar.
        uses: actions/checkout@v4

      - name: PHP Kurulumu
        # PHP ortamÄ±nÄ± kurar. PHP sÃ¼rÃ¼mÃ¼nÃ¼ belirtebilirsiniz (Ã¶rneÄŸin '8.x').
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.x' # PHP sÃ¼rÃ¼mÃ¼nÃ¼zÃ¼ buraya yazÄ±n (Ã¶rn. '7.4', '8.0', '8.1', '8.2', '8.3')
          extensions: curl, dom, xml # cURL, DOM ve XML uzantÄ±larÄ±nÄ± etkinleÅŸtirir

      - name: EPG PHP BetiÄŸini Ã‡alÄ±ÅŸtÄ±r
        # DigitÃ¼rkepg.php betiÄŸini Ã§alÄ±ÅŸtÄ±rÄ±r.
        # BetiÄŸin Ã§Ä±ktÄ± olarak bir epg.xml dosyasÄ± oluÅŸturduÄŸunu varsayarÄ±z.
        run: |
          php DigitÃ¼rkepg.php
          ls -lah # Hata ayÄ±klama iÃ§in oluÅŸturulan dosyalarÄ± listeler

      - name: DeÄŸiÅŸiklikleri Kaydet ve Push Et
        # OluÅŸturulan epg.xml dosyasÄ±nÄ± Git deposuna kaydeder ve geri yÃ¼kler.
        run: |
          git config --global user.name "github-actions[bot]" # Git commit iÃ§in kullanÄ±cÄ± adÄ± ayarlar
          git config --global user.email "github-actions[bot]@users.noreply.github.com" # Git commit iÃ§in e-posta ayarlar
          
          git add digiphpepg.xml || echo "epg.xml dosyasÄ± bulunamadÄ± veya eklenemedi." # epg.xml dosyasÄ±nÄ± ekler
          
          # YalnÄ±zca deÄŸiÅŸiklik varsa commit yapar.
          git commit -m "ğŸ”„ EPG otomatik gÃ¼ncellendi (PHP)" || echo "YapÄ±lacak bir deÄŸiÅŸiklik yok."
          
          git push origin main || echo "Push iÅŸlemi baÅŸarÄ±sÄ±z oldu veya gerekli deÄŸildi." # DeÄŸiÅŸiklikleri main dalÄ±na gÃ¶nderir
